{% extends 'base.jinja2' %}

{% block content %}
    {% if phase == 0 %}
        <div class="quiz-center">
            <h1>{{ step.title }}</h1>
            {% if step.text %}
                {% set desc = step.text | rich_text %}
                <div class="quiz-layout">
                    <div class="quiz-col">
                        {% if desc.has_text %}
                            <div class="quiz-description{% if desc.is_multi %} quiz-description--multi{% endif %}">
                                {{ desc.html }}
                            </div>
                        {% endif %}
                    </div>
                    <div class="quiz-col">
                        <ol class="quiz-options no-counter">
                            {% for opt in options %}
                                <li>{{ opt.text }}</li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
            {% else %}
                <div class="quiz-col">
                    <ol class="quiz-options quiz-options-alone no-counter">
                        {% for opt in options %}
                            <li>{{ opt.text }}</li>
                        {% endfor %}
                    </ol>
                </div>
            {% endif %}
        </div>
    {% else %}
        <div class="quiz-center">
            <h1>{{ step.title }}</h1>
            <div class="quiz-layout">
                <div class="quiz-col">
                    <div class="sequence-details">
                        {% if step.text %}
                            {% set desc = step.text | rich_text %}
                            {% if desc.has_text %}
                                <div class="sequence-description">
                                    <div class="quiz-description{% if desc.is_multi %} quiz-description--multi{% endif %}">
                                        {{ desc.html }}
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                        <ol class="quiz-options">
                            {% for opt in options %}
                                <li>{{ opt.text }}</li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
                <div class="quiz-col chart-col">
                    <div class="mcq-container">
                        <canvas id="mcqChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <script>
            window.__mcq = {
                labels: ['{{ texts.SEQUENCE_STATS_CORRECT }}', '{{ texts.SEQUENCE_STATS_WRONG }}'],
                counts: [{% for c in counts %}{{ c }}{% if not loop.last %}, {% endif %}{% endfor %}],
                percents: [{% for p in percents %}{{ p }}{% if not loop.last %}, {% endif %}{% endfor %}],
                correct: 0,
                avatars: [
                    [{% for id in avatars_map[0] %}'{{ id }}'{% if not loop.last %}, {% endif %}{% endfor %}],
                    [{% for id in avatars_map[1] %}'{{ id }}'{% if not loop.last %}, {% endif %}{% endfor %}]
                ],
                names: {
                    {% for id, name in names_map.items() %}'{{ id }}': '{{ name|replace("'", "\\'") }}'{% if not loop.last %}, {% endif %}{% endfor %}
                }
            };
            document.addEventListener('DOMContentLoaded', () => window.renderMcq());
        </script>
    {% endif %}
{% endblock %}
