{% extends 'base.jinja2' %}

{% block content %}
  <div class="quiz-viewport">
    <div class="quiz-card">

      <h1 class="quiz-title">{{ step.title }}</h1>

      {% if phase == 0 %}
        {% if quiz_description %}
          <div class="quiz-grid">
            <div class="quiz-description">
              {{ quiz_description | safe }}
            </div>
            <ol class="quiz-options">
              {% for opt in options %}
                <li>{{ opt.text }}</li>
              {% endfor %}
            </ol>
          </div>
        {% else %}
          <ol class="quiz-options quiz-options-alone">
            {% for opt in options %}
              <li>{{ opt.text }}</li>
            {% endfor %}
          </ol>
        {% endif %}
      {% else %}
        {% if quiz_description %}
          <div class="quiz-description quiz-description-results">
            {{ quiz_description | safe }}
          </div>
        {% endif %}
        <div class="mcq-container">
          <canvas id="mcqChart"></canvas>
        </div>
        <script>
          window.__mcq = {
            labels: [{% for opt in options %}'{{ loop.index }}. {{ opt.text|replace("'", "\\'") }}',{% endfor %}],
            counts: [{% for c in counts %}{{ c }},{% endfor %}],
            percents: [{% for p in percents %}{{ p }},{% endfor %}],
            correct: {{ correct }},
            avatars: [
              {% for arr in avatars_map %}[
                {% for id in arr %}'{{ id }}'{% if not loop.last %},{% endif %}{% endfor %}
              ]{% if not loop.last %},{% endif %}{% endfor %}
            ],
            names: {
              {% for id, name in names_map.items() %}'{{ id }}': '{{ name|replace("'", "\\'") }}'{% if not loop.last %},{% endif %}{% endfor %}
            }
          };
          document.addEventListener('DOMContentLoaded', () => window.renderMcq());
        </script>
      {% endif %}

    </div>
  </div>
{% endblock %}
