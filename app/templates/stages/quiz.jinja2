{% extends 'base.jinja2' %}

{% block content %}
  <h1>{{ step.title }}</h1>
  {% if step.text %}
    <p class="description">{{ step.text }}</p>
  {% endif %}
  {% if phase == 0 %}
    <ol class="quiz-options{% if not step.text %} quiz-options-alone{% endif %}">
      {% for opt in options %}
        <li>{{ opt.text }}</li>
      {% endfor %}
    </ol>
  {% else %}
    <div class="mcq-container"><canvas id="mcqChart"></canvas></div>
    <script>
      window.__mcq = {
        labels: [{% for opt in options %}'{{ loop.index }}. {{ opt.text|replace("'", "\\'") }}',{% endfor %}],
        counts: [{% for c in counts %}{{ c }},{% endfor %}],
        percents: [{% for p in percents %}{{ p }},{% endfor %}],
        correct: {{ correct }},
        avatars: [
          {% for arr in avatars_map %}[
            {% for id in arr %}'{{ id }}'{% if not loop.last %},{% endif %}{% endfor %}
          ]{% if not loop.last %},{% endif %}{% endfor %}
        ],
        names: {
          {% for id, name in names_map.items() %}'{{ id }}': '{{ name|replace("'", "\\'") }}'{% if not loop.last %},{% endif %}{% endfor %}
        }
      };
      document.addEventListener('DOMContentLoaded', () => window.renderMcq());
    </script>
  {% endif %}
{% endblock %}
