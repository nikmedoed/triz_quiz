{% extends 'base.jinja2' %}

{% block content %}
  <h1 class="page__problem-title">{{ step.title }}</h1>
  {% if phase == 0 %}
    <p class="description">{{ step.text }}</p>
  {% elif phase in [1, 2] and ideas %}
    <div class="ideas-wrap" id="ideasWrap">
      <div class="ideas-grid">
        {% set voters_map = voters_map if voters_map is defined else {} %}
        {% for idea in ideas %}
        {% set voters = voters_map.get(idea.id) or [] %}
        <article class="idea-card" data-idea-id="{{ idea.id }}">
          <div class="idea-card__star">â˜… {{ voters|length }}</div>
          <header class="idea-card__head">
            <div class="idea-card__number">#{{ loop.index }}</div>
            <div class="idea-card__time idea-card__time--top">{{ texts.ANSWER_TOOK.format(time=idea.delay_text) }}</div>
            <div class="idea-card__author">
              <img class="idea-card__avatar" src="/avatars/{{ idea.author.id }}.png" alt="" />
              <div class="idea-card__author-info">
                <div class="idea-card__name">{{ idea.author.name }}</div>
                <div class="idea-card__time idea-card__time--under-author">{{ texts.ANSWER_TOOK.format(time=idea.delay_text) }}</div>
              </div>
            </div>
          </header>
          <div class="idea-card__body">
            <p class="idea-card__text">{{ idea.text }}</p>
          </div>
          <footer class="idea-card__foot">
            <div class="idea-card__voters">
              {% for v in voters %}
                <img class="idea-card__voter" src="/avatars/{{ v.id }}.png" alt="" title="{{ v.name }}" />
              {% endfor %}
            </div>
          </footer>
        </article>
        {% endfor %}
      </div>
    </div>
    <script>
      applyPhase(document.getElementById('ideasWrap'), '{{ 'voting' if phase == 1 else 'results' }}');
    </script>
  {% elif phase in [1, 2] %}
    <p class="question">{{ texts.NO_IDEAS }}</p>
  {% endif %}
{% endblock %}
