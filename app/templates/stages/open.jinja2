{% extends 'base.jinja2' %}

{% block content %}
  <h1 class="page__problem-title">{{ step.title }}</h1>
  {% if phase == 0 %}
    <p class="description">{{ step.text }}</p>
  {% elif phase in [1, 2] and ideas %}
    <div class="ideas-wrap phase--{{ 'voting' if phase == 1 else 'results' }}" id="ideasWrap">
      <div class="ideas-grid">
        {% set voters_map = voters_map if voters_map is defined else {} %}
        {% for idea in ideas %}
        {% set voters = voters_map.get(idea.id) or [] %}
        <article class="idea-card" data-idea-id="{{ idea.id }}">
          {% if phase == 2 %}
          <div class="idea-card__star">â˜… {{ voters|length }}</div>
          {% endif %}
          <header class="idea-card__head">
            <div class="idea-card__number">#{{ loop.index }}</div>
            {% if phase == 1 %}
            <div class="idea-card__time idea-card__time--top">{{ texts.ANSWER_TOOK.format(time=idea.delay_text) }}</div>
            {% else %}
            <img class="idea-card__avatar" src="/avatars/{{ idea.author.id }}.png" alt="" />
            <div class="idea-card__author">
              <div class="idea-card__name">{{ idea.author.name }}</div>
              <div class="idea-card__time idea-card__time--under-author">{{ texts.ANSWER_TOOK.format(time=idea.delay_text) }}</div>
            </div>
            {% endif %}
          </header>
          <div class="idea-card__body">
            {% if phase == 2 %}
            <details class="idea-card__details">
              <summary class="idea-card__summary">
                <span class="idea-card__text idea-card__text--clamped">{{ idea.text }}</span>
              </summary>
              <p class="idea-card__text">{{ idea.text }}</p>
            </details>
            {% else %}
            <p class="idea-card__text">{{ idea.text }}</p>
            {% endif %}
          </div>
          {% if phase == 2 %}
          <footer class="idea-card__foot">
            <div class="idea-card__voters">
              {% for v in voters %}
                <img class="idea-card__voter" src="/avatars/{{ v.id }}.png" alt="" title="{{ v.name }}" />
              {% endfor %}
            </div>
          </footer>
          {% endif %}
        </article>
        {% endfor %}
      </div>
    </div>
    <script>
      applyPhase(document.getElementById('ideasWrap'), '{{ 'voting' if phase == 1 else 'results' }}');
    </script>
  {% elif phase in [1, 2] %}
    <p class="question">{{ texts.NO_IDEAS }}</p>
  {% endif %}
{% endblock %}
